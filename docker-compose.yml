version: "3.9"

services:
  petclinic-db:
    image: mysql:8.0
    container_name: petclinic-db
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: petclinic
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    ports:
      - "3307:3306"

  petclinic-app:
    build: .   # أو build: . إذا الكود في الجذر
    container_name: petclinic-app
    ports:
      - "30082:9966"
    environment:
      - SPRING_PROFILES_ACTIVE=mysql
      - SPRING_DATASOURCE_URL=jdbc:mysql://petclinic-db:3306/petclinic
      - SPRING_DATASOURCE_USERNAME=user
      - SPRING_DATASOURCE_PASSWORD=password
    depends_on:
      - petclinic-db

  prometheus:
    build: ./monitoring
    container_name: prometheus
    ports:
      - "30090:9090"
    depends_on:
      - petclinic-app

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - "30091:3000"
    depends_on:
      - prometheus

